<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{admin/dashBoard}">
    <script src="https://code.jquery.com/jquery-3.6.3.js" integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM=" crossorigin="anonymous"></script>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!-- Favicon -->
<link rel="shortcut icon" href="/img/favicon.ico">
<!-- CSS Template -->
<link href="/css/swimwear.css" rel="stylesheet">

</head>
<body>
    <div layout:fragment="content">

        <!-- 본문 시작 -->
        <div class="page-breadcrumb bg-white">
            <div class="row align-items-center">
                <div class="col-lg-3 col-md-4 col-sm-4 col-xs-12">
                    <h3 class="page-title">회원 관리</h3>
                </div>
            </div>
        </div>

        <!-- 테이블 시작 -->
        <div id="memberList">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="white-box">
                            <div>
                                <!-- 분류 이름 -->
                                <h3 class="box-title">회원</h3>
                                

  
  
                                <!-- 통계 정보 -->
                                <p class="text-muted" style="float:left; font-size:16px; margin-top:3px;">
                                    신규 회원: <code th:text="${todayMem.size}"></code> &nbsp; 총 회원: <code th:text="${memberList.size}"></code></p>
                                <!-- 검색 -->
                                <form id="searchFrm" action="/admin/memberManage" th:object="${page}" class="app-search d-none d-md-block me-3">
                                    <ul style="list-style:none;float:right;">
                                        <li>
                                            <select name="type" style="width:120px;height:30px;font-size:16px;border:none;">
                                             	<option value="all">전체</option>
                                                <option value="id">아이디</option>
                                                <option value="name">이름</option>
                                                <option value="email">이메일</option>
                                                <option value="tel">휴대전화</option>
                                                <option value="joinDate">가입날짜</option>
                                                <option value="birthDate">생년월일</option>
                                                <option value="genCd">성별</option>
                                                <option value="pointSum">포인트</option>
                                                <option value="memCd">멤버권한</option>
                                            </select>
		<input type="hidden" name="pageNum" th:value="*{criteria.pageNum}">
		<input type="hidden" name="amount" th:value="*{criteria.amount}">

                                            <input type="text" name="keyward" th:value="*{criteria.keyword}" placeholder="Search..." class="form-control mt-0"
                                                style="display:inline-block;width:300px;height:30px;font-size:16px;">
				<button class="btn btn-default">검색</button>
                                        </li>
                                    </ul>
                                </form>
                                
                                
                              
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                                
                            </div>
                            <br>
                            <hr>
                            <!-- 회원 관리 본문 -->
                            
                                    <form id="memberFrm" method="post" action="/deleteMember">
                            <div class="table-responsive">
                                <!-- 회원 테이블 -->
                           <button type="button" class="btn btn-danger" style="color:white;" th:attr="onclick=|deleteMemberAll()|">선택삭제</button>
                                <table class="table text-nowrap">
                                    
                                    <thead>
                                    
                                        <tr>
                                        
         									<th><input type="checkbox" id="chkMemAllBox" th:attr="onclick=|chkMemAll()|"></th>
                                            <th class="border-top-0">#</th>
                                            <th class="border-top-0">아이디</th>
                                            <th class="border-top-0">이름</th>
                                            <th class="border-top-0">이메일</th>
                                            <th class="border-top-0">휴대전화</th>
                                            <th class="border-top-0">가입날짜</th>
                                            <th class="border-top-0">생년월일</th>
                                            <th class="border-top-0">성별</th>
                                            <th class="border-top-0">포인트</th>
                                            <th class="border-top-0">멤버권한</th>
                                                               
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr th:each="mem,sts : ${memberList}" th:Class="${sts}">
                                        
                                    	    <td align="center"><input type="checkbox" th:if="${#strings.equals(mem.memCd, 'M1')}" id="memberBox" ></td>
                                            <td th:text="${sts.count}"></td>
                                            <td th:text="${mem.id}" th:value="${mem.id}" id="id" th:name="id"></td>
                                            <td th:text="${mem.name}" th:value="${mem.name}"></td>
                                            <td th:text="${mem.email}" th:value="${mem.email}"></td>
                                            <td th:text="${mem.tel}" th:value="${mem.tel}"></td>
                                            <td th:text="${mem.joinDate}" th:value="${mem.joinDate}"></td>
                                            <td th:text="${mem.birthDate}" th:value="${mem.birthDate}"></td>
                                            <td th:text="${mem.genCd}" th:value="${mem.genCd}"></td>
                                            <td th:text="${mem.pointSum}" th:value="${mem.pointSum}"></td>
                                            <td th:text="${mem.memCd}" th:value="${mem.memCd}"></td>
                                            
                                            <td><button type="button" class="btn btn-success" style="color:white;">수정</button>
                                            &nbsp;
                                              
                                            <button th:if="${#strings.equals(mem.memCd, 'M1')}" type="button" class="btn btn-danger" 
                                            style="color:white;" th:attr="onclick=|deleteMember('${mem.id}')|" id="delBtn">삭제</button></td>
                                            
                                        
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            </form>
                            
                            <!-- 회원리스트 페이징  -->
                            <div>
                            
   <div class="pagination">
		<a th:if="${page.prev}" th:href="${page.startPage-1}">&laquo;</a>
		<a th:each="num : ${#numbers.sequence(page.getStartPage(), page.getEndPage())}" th:href="${num}"
		    th:class="${page.criteria.pageNum==num} ? 'active'">[[${num}]]</a>
		<a th:if="${page.next}" th:href="${page.endPage+1}">&raquo;</a>
	</div>
	<form id="actionFrm" action="/admin/memberManage" th:object="${page}">
		<input type="hidden" name="pageNum" th:value="*{criteria.pageNum}">
		<input type="hidden" name="amount" th:value="*{criteria.amount}">
		<input type="hidden" name="type" th:value="*{criteria.type}">
		<input type="hidden" name="keyword" th:value="*{criteria.keyword}">
	</form>
</div>

<!-- 페이징 끝 -->
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 기록가 테이블  -->
        <div id="ptgTable">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="white-box">
                            <div>
                            <span>
                     <input type="button" class="box-title" style="background-color:white;border:none;" value="기록가" th:attr="onclick=|openPtgList()|">
  					&nbsp;<input type="button" class="box-title" style="background-color:white;border:none;color:grey;" value="사진관" th:attr="onclick=|openStdList()|">
                            </span>
		<br>
                                <p class="text-muted" style="float:left; font-size:16px; margin-top:3px;">
                                    신규 기록가: <code th:text="${todayPtg.size}"></code> &nbsp; 총 기록가: <code th:text="${ptgList.size}"></code></p>
                                <form role="search" class="app-search d-none d-md-block me-3">
                                    <ul style="list-style:none;float:right;">
                                        <li>
                                            <select style="width:120px;height:30px;font-size:16px;border:none;">
                                                <option value="">#번호</option>
                                                <option value="">작가아이디</option>
                                                <option value="">사진관아이디</option>
                                                <option value="">지역</option>
                                                <option value="">사업자등록번호</option>
                                                <option value="">인스타주소</option>
                                                <option value="">근무가능요일</option>
                                                <option value="">등록일자</option>
                                                <option value="">소속여부</option>
                                            </select>
                                            <input type="text" placeholder="Search..." class="form-control mt-0"
                                                style="display:inline-block;width:300px;height:30px;font-size:16px;">
                                          <button class="btn btn-default">검색</button>
                                            </a>
                                        </li>
                                    </ul>
                                </form>
                            </div>

                            <br>
                            <hr>
                            <div class="table-responsive">
                                <table class="table text-nowrap">
                                    <thead>
                                        <tr>
                                            <!-- 보여줄 부분 -->
                                            <th class="border-top-0">#</th>
                                            <th class="border-top-0">작가아이디</th>
                                            <th class="border-top-0">사진관아이디</th>
                                            <th class="border-top-0">지역</th>
                                            <th class="border-top-0">사업자등록번호</th>
                                            <th class="border-top-0">인스타주소</th>
                                            <th class="border-top-0">근무가능요일</th>
                                            <th class="border-top-0">소속여부</th>
                                            <th class="border-top-0">등록일자</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                           <tr th:each="ptg,sts : ${ptgList}" th:Class="${sts}">                                
                                            <td th:text="${sts.count}"></td>    
                                            <td th:text="${ptg.ptgId}"></td>
                                            <td th:text="${ptg.stId}"></td>
                                            <td th:text="${ptg.regionCd}"></td>
                                            <td th:text="${ptg.crn}"></td>
                                            <td th:text="${ptg.inst}"></td>
                                            <td th:text="${ptg.workDay}"></td>
                                            <td th:text="${ptg.ptgCd}"></td>
                                            <td th:text="${ptg.regiDate}"></td>
                                            <td><button type="button" class="btn btn-success" style="color:white;">수정</button></td>
                                            <td><button type="button" class="btn btn-danger" style="color:white;">삭제</button></td>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 사진관 테이블 -->
        <div id="stdTable" style="display:none">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-sm-12">
                        <div class="white-box">
                            <div>
                            <span>
                     <input type="button" class="box-title" style="background-color:white;border:none;color:grey;" value="기록가" th:attr="onclick=|openPtgList()|">
  					&nbsp;<input type="button" class="box-title" style="background-color:white;border:none;" value="사진관" th:attr="onclick=|openStdList()|">
                            </span>
                            <br>
                                <p class="text-muted" style="float:left; font-size:16px; margin-top:3px;">
                                    신규 사진관: <code th:text="${todayStd.size}">5</code> &nbsp; 총 사진관: <code th:text="${stdList.size}"></code></p>
                                <form role="search" class="app-search d-none d-md-block me-3">
                                    <ul style="list-style:none;float:right;">
                                        <li>
                                            <select style="width:120px;height:30px;font-size:16px;border:none;">
                                                <option value="">#번호</option>
                                                <option value="">사진관아이디</option>
                                                <option value="">이름</option>
                                                <option value="">대표자</option>
                                                <option value="">전화번호</option>
                                                <option value="">지역</option>
                                                <option value="">주소</option>
                                                <option value="">사업자등록번호</option>
                                                <option value="">등록일자</option>
                                            </select>
                                            <input type="text" placeholder="Search..." class="form-control mt-0"
                                                style="display:inline-block;width:300px;height:30px;font-size:16px;">
                                            <a href="" class="active"><i class="fa fa-search"></i>
                                            </a>
                                        </li>
                                    </ul>
                                </form>
                            </div>

                            <br>
                            <hr>
                            <div class="table-responsive">
                                <table class="table text-nowrap">
                                    <thead>
                                        <tr>
                                            <!-- 보여줄 부분 -->
                                            <th class="border-top-0">#</th>
                                            <th class="border-top-0">사진관아이디</th>
                                            <th class="border-top-0">이름</th>
                                            <th class="border-top-0">대표자</th>
                                            <th class="border-top-0">전화번호</th>
                                            <th class="border-top-0">지역</th>
                                            <th class="border-top-0">주소</th>
                                            <th class="border-top-0">사업자등록번호</th>
                                            <th class="border-top-0">등록일자</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                           <tr th:each="std,sts : ${stdList}" th:Class="${sts}">                                
                                            <td th:text="${sts.count}"></td>    
                                            <td th:text="${std.stId}"></td>
                                            <td th:text="${std.stName}"></td>
                                            <td th:text="${std.ceoName}"></td>
                                            <td th:text="${std.tel}"></td>
                                            <td th:text="${std.regionCd}"></td>
                                            <td th:text="${std.addr}"></td>
                                            <td th:text="${std.crn}"></td>
                                            
                                            <td><button type="button" class="btn btn-success" style="color:white;">수정</button>
                                            &nbsp;
                                             
                                             
                                            <button type="button" class="btn btn-danger" th:if="${#strings.equals(std.stCd, 'S')}"
                                            style="color:white;" id="delBtn">삭제</button>
                                            <button class="btn btn-secondary" th:if="${#strings.equals(std.stCd, 'G')}" style="color:white;" type="button" id ="updateBtn"  data-bs-toggle="modal" 
                                            data-bs-target="#StdsPtgList"  th:attr="onclick=|belongAjax('${std.stId}')|">소속작가</button>    
                                            
                                           
                                            <!-- |location.href='@{belongPtg(stId=${std.stId})}' 
                                            'belongAjax(${std.stId})"-->
                                            </td>
                                        </tr>
                                        <!-- 삭제할 것 -->

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        
        <!-- Std ->PtgList Popup  -->
<div class="modal fade" id="StdsPtgList">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header bg-primary">
                <div class="modal-title p-3">
                    <h5 class="m-0 text-white"  id="blStd"></h5>
                  
                   <p class="m-0 text-white"></p>
                  
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="w-100 p-3">
                    <!-- Form START -->
                    <form>
                                <table class="table text-nowrap" id="blTable">
                                    <thead>
                                        <tr>
                                            <!-- 보여줄 부분 -->
                                            <th class="border-top-0">#</th>
                                            <th class="border-top-0">작가아이디</th>
                                            <th class="border-top-0">사업자등록번호</th>
                                        </tr>
                                    </thead>
                                    <tbody id="blBody">

                                    </tbody>
                                </table>
                                
                                
<!-- 
                                
                                    <tbody>
                                        <tr>                               
                                            <td id="blNum"></td>    
                                            <td id="blPtgId"></td>
                                            <td id="blPtgCrn"></td>                                          
                                        </tr>

                                    </tbody>
                                </table>         
 -->                                
                                
                                
                                
                                
                                
                                
                                
                                
  
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End Login Popup  -->
        
<script th:inline="javascript">

//클릭으로 테이블 보이기 여부 
		const ptgTable = document.getElementById("ptgTable");
	    const stdTable = document.getElementById("stdTable");
	    
		function openPtgList(){
	    	ptgTable.style.display = 'block';
	    	stdTable.style.display = 'none';
	    };
	    
		function openStdList(){		
	    	ptgTable.style.display = 'none';
	    	stdTable.style.display = 'block';
	    };
	
	    
//단건 삭제버튼. id값만 넘기면서 페이지 새로고침
	    function deleteMember(id){
	
			var id= id;
	    	if(confirm(id+"님을 정말 삭제하시겠습니까? 삭제 후 복구할 수 없습니다.")==true){
		
		location.replace('/deleteMember?id='+id); 
		console.log("넘어감");
	    	}else{
	    		alert("취소되었습니다.");
	    	}

	    };

//다건 삭제버튼

		function chkMemAll(){
         if($("#chkMemAllBox").prop("checked")){
        	 console.log("클릭은 됨")
            $("input[id*='memberBox']").prop("checked",true); 
        }else{
            $("input[id*='memberBox']").prop("checked",false); 
        }
    };

    
    
    

    function deleteMemberAll(){
    		 var ids = '';
    	let list = [];
    	
    	 $("[id='memberBox']:checked").each(function(i, checkbox){
    		 var tr = $(checkbox).parent().parent();
    		 var td = $(tr).children();
    		 
    		 var id = td.eq(2).text();

    		 ids+= id+"님 ";

    		 var obj = {};
    		 //obj["id"] = id;
    		 
    		 //list.push(obj);
    		 list.push(id);
    		 
    	 });
 	    	if(confirm(ids+"을 정말 삭제하시겠습니까? 삭제 후 복구할 수 없습니다.")==true){
 	   		
 	    		for (const value of list) {
 	    		    console.log("삭제할거얌"+value);
 	    		   location.replace('/deleteMember?id='+value);
 	    		} 
 
 	    		alert("삭제 완료");
 	   	    	
 	    	}else{
 	   	    		alert("취소되었습니다.");
 	   	    	}
    		 

    };
    
    

    function belongAjax(stId){

    var stId = stId;
    	console.log("stId는 "+stId);
	$('#blBody').empty();
    	
      $.ajax({
        type: "POST",
        url: "/belongPtg",
        data: "stId=" + stId,
      }).then(map =>{

	
		document.createElement('tbody').setAttribute('id','blBody');
    	$("#blTable").append($("#blBody"));
    	
    	
		var Stbelong = map.STbelong;
    	  $("#blStd").text(Stbelong+"님의 소속작가");
    	  console.log("Stbelong은요"+ Stbelong);
    	  
    	  var results = map.belongPtg;
    	  var str ='<TR>';
    	  
    	  $.each(results, function(i){
    		  str += '<TD>'+(i+1)+'</TD><TD>' + results[i].ptgId + '</TD><TD>'+ results[i].crn + '</TD>';
    		  str +='</tr>';
    	  });
    	  $("#blBody").append(str);
    	  
    	});
    };
      
      
   //   <tr th:each="bl,sts : ${belongPtg}" th:Class="${sts}">                               
    //  <td th:text="${sts.count}"></td>    
    //  <td th:text="${bl.ptgId}"></td>
    //  <td th:text="${bl.crn}"></td>                                          
  //</tr>

  //페이징 스크립트 

history.replaceState({}, null, location.pathname);

$(".pagination a").on("click", function(e){
	e.preventDefault();
	console.log($("#actionFrm").find("input[name='pageNum']").val())
 	$("#actionFrm").find("input[name='pageNum']").val($(this).attr("href"));
	
	actionFrm.submit(); //폼태그값을 스트링으로 
})

	console.log($('input[type="checkbox"]:checked').val())
	
$('#searchFrm button').on("click", function(e){
	console.log('click')
	
	
	$('#searchFrm').find("input[name='pageNum']").val(1);
	e.preventDefault();
	searchFrm.submit();
})




 
</script>
    </div>
</body>
</html>