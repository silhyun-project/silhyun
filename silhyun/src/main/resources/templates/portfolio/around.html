<!doctype html>
<html lang="zxx" xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{home/layout}">

<head>
<!-- metas -->
<meta charset="utf-8">
<meta name="author" content="pxdraft" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="keywords" content="ShopApp - eCommerce Bootstrap 5 Template" />
<meta name="description"
	content="ShopApp - eCommerce Bootstrap 5 Template" />
<!-- title -->
<title>ShopApp - eCommerce Bootstrap 5 Template</title>
<!-- Favicon -->
<link rel="shortcut icon" href="/img/favicon.ico">
<!-- CSS Template -->
<link href="/css/theme.css" rel="stylesheet">
<link href="/css/around.css" rel="stylesheet">

<!-- 자체어쩌구-->
<link href="/css/around.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.3.js"
	integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM="
	crossorigin="anonymous"></script>
<!-- 자체어쩌구 -->
</head>

<body>
	<div layout:fragment="content">

		<!-- Main -->
		<main>
			<!-- Breadcrumb -->
			<div class="py-3 bg-gray-100">
				<div class="container-fluid px-xxl-8">
					<div class="row align-items-center">
						<div class="col-lg-6 my-2">
							<h1 class="m-0 h4 text-center text-lg-start">둘러보기</h1>
						</div>
						<div class="col-lg-6 my-2">
							<ol
								class="breadcrumb dark-link m-0 small justify-content-center justify-content-lg-end">
								<li class="breadcrumb-item"><a class="text-nowrap" href="#"><i
										class="bi bi-home"></i>Home</a></li>
								<li class="breadcrumb-item text-nowrap active"
									aria-current="page">Product</li>
							</ol>
						</div>
					</div>
				</div>
			</div>
			<!-- End Breadcrumb -->
			<!-- Shop -->
			<section class="py-6">
				<div class="container-fluid px-xxl-8">
					<div class="row">
						<!-- Sidebar -->
						<div
							class="col shop-sidebar-option-04 d-none d-lg-block mb-auto sticky-lg-top sticky-lg-top-header">
							<!-- Categories -->
							<div class="shop-categories-list">
								<div class="shop-attr-body">
									<ul class="nav nav-level-1 flex-column">
										<li class="nav-item"><a href="#" class="nav-link">둘러보기</a>
										</li>

									</ul>
									<ul class="nav flex-column">
										<li class="nav-item"><a href="#" class="nav-link active">둘러보기</a>
										</li>
										<li class="nav-item"><a href="#" class="nav-link">후기
												모음</a></li>
										<li class="nav-item"><a href="#" class="nav-link">장소
												추천</a></li>
										<li class="nav-item"><a href="#" class="nav-link">팁
												게시글</a></li>
										<li class="nav-item"><a href="#" class="nav-link">온라인
												전시회</a></li>

									</ul>
								</div>
							</div>
							<!-- End Categories -->
						</div>
						<!-- End Sidebar -->
						<!-- Product Box -->
						<div class="col-lg-8 col-xl-9">

							<!-- 검색창 -->
							<div class="col-md-6">

								<div class="form">
									<i class="bi-search"></i> <input type="text"
										class="form-control form-input" placeholder="태그검색"> <span id="text">
										인스타그램 해시태그를 #사용해서 표현하면 자동으로 링크가 걸리도록 구현해 보세요.
									</span>
								</div>

							</div>
							<br>
							<!-- 검색창 끝-->

							<p class="michin-nom" display:none>[[${#lists.size(portfolioList)}]]</p>
							<p class="michin-nom">[[${portfolioList[0]}]]</p>

							<!-- 태그버튼 -->
							<div class="shop-top-bar d-flex pb-3">
								<div class="layout-change">
									<!-- 태그자리 -->
								</div>

								<!-- 태그버튼 -->
								<div class="shortby-dropdown ms-auto">
									<div class="standLineButton">
										<div class="dropdown">
											<a class="toggleButton" role="button">정렬</a>
											<ul class="toggleMenu">
												<li><a class="dropdown-item">최신순</a></li>
												<li><a class="dropdown-item">좋아요순</a></li>
											</ul>
										</div>
									</div>
								</div>


								<!-- 태그버튼 -->

							</div>

							<!-- 사진붙이는 태그 -->
							<div class="row g-3" id="rowg-3">


								<!-- 첨에 들어갔을 때 포트폴리오 저장된 사진 보여주는 ~ Product Box -->


								<!-- 사진 자리~~ -->

							</div>
							<div class="shop-bottom-bar d-flex align-items-center mt-3">
								<div>Showing: 1 - 12 of 17</div>
								<div class="ms-auto">
									<ul class="pagination">
										<li class="page-item"><a class="page-link" href="#"
											aria-label="Previous"> <span aria-hidden="true">&laquo;</span>
										</a></li>
										<li class="page-item active"><a class="page-link"
											href="#">1</a></li>
										<li class="page-item"><a class="page-link" href="#">2</a></li>
										<li class="page-item"><a class="page-link" href="#">3</a></li>
										<li class="page-item"><a class="page-link" href="#"
											aria-label="Next"> <span aria-hidden="true">&raquo;</span>
										</a></li>
									</ul>
								</div>
							</div>
						</div>
						<!-- End Product Box -->
					</div>
				</div>
			</section>
			<!-- End Shop -->
		</main>
		<!-- End Main -->



		<!-- 모달 시작 -->
		<section class="product-details py-6">
			<div class="container modalContainer">
				<div class="modal modal-overlay">
					<div class="close-area">X</div>
					<div class="row align-items-start modal-window">
						<!-- Product Gallery -->
						<div
							class="col-lg-6 lightbox-gallery sticky-lg-top sticky-lg-top-header modalPic">
							<div class="swiper swiper-container"
								data-swiper-options='{
                  "slidesPerView": 1,
                  "spaceBetween": 0,
                  "pagination": {
                    "el": ".swiper-pagination",
                    "clickable": true
                  },
                  "navigation": {
                    "nextEl": ".swiper-next-01",
                    "prevEl": ".swiper-prev-01"
                  }
                }'>
								<div class="swiper-wrapper slidePhoto">
									<!-- 사진 및 사진넘기는 버튼어쩌구 자리-->
								</div>
							</div>

						</div>
						<!-- End Product Gallery -->
						<!-- Product Details -->
						<div class="col-lg-6 ps-lg-5 pt-5 pt-lg-0" id="modalCon">

							<!-- 작가프로필 아이디 자리 시작-->
							<div class="modalHeader"></div>
							<!-- 작가프로필 아이디 자리 끝-->
							<!-- 내용 및 댓글 시작-->
							<div class="modalConList">
								<div class="product-description"
									style="overflow-y: scroll; height: 100%;">

									<div
										class="d-flex review-box border-top mt-4 pt-4 modalContentSit">
										<!-- 포트폴리오 내용 자리 -->
									</div>

									<hr>

									<div class="col-lg-8 pe-lg-8">
										<div class="products-brand pb-2">
											<span>댓글</span>
										</div>
									</div>

									<!-- 댓글자리 -->
									<div class="d-flex review-box border-top mt-4 pt-4">
										<div>
											<div class="review-image">
												<img class="img-fluid" src="/img/fashion/1000x1000.jpg"
													title="" alt="프로필사진자리~~~~">
											</div>
										</div>
										<div class="col ps-3">
											<span><strong class="comNick">닉넴</strong></span>&nbsp;&nbsp;
											<span class="m-0 pt-3">댓글내용자리요...</span> 댓글쓴시간 댓글쓰기

											<!-- 덧댓글자리 -->
											<div class="product-detail-collapse">
												<div class="pd-collapse-row">
													<a class="pd-collapse-h5" data-bs-toggle="collapse"
														href="#pd_review" role="button" aria-expanded="false"
														aria-controls="pd_review">댓글더보기(덧댓글개수)이 자체가 잇으면 보여주기.</a>
													<div class="collapse" id="pd_review">
														<div class="pd-collapse-box">
															<div class="row align-items-end"></div>
															<div class="d-flex review-box border-top mt-4 pt-4">
																<div>
																	<div class="review-image">
																		<img class="img-fluid"
																			src="/img/fashion/1000x1000.jpg" title=""
																			alt="프로필사진자리~~~~">
																	</div>
																</div>
																<div class="col ps-3">
																	<span><strong class="comNick">닉넴</strong></span>&nbsp;&nbsp;
																	<span class="m-0 pt-3">댓글내용자리요...</span>
																</div>
															</div>

														</div>
													</div>
												</div>
											</div>
											<!-- 덧댓글자리 -->


										</div>
									</div>
									<div class="d-flex review-box border-top mt-4 pt-4">
										<div>
											<div class="review-image">
												<img class="img-fluid" src="/img/fashion/1000x1000.jpg"
													title="" alt="프로필사진자리~~~~">
											</div>
										</div>
										<div class="col ps-3">
											<span><strong class="comNick">닉넴</strong></span>&nbsp;&nbsp;
											<span class="m-0 pt-3">댓글내용자리요...</span>
										</div>
									</div>
								</div>
								<!-- 댓글리스트 -->
							</div>
							<!-- 내용 및 댓글 끝-->
							<div class="modalFooter">
								<div class="product-detail-actions d-flex flex-wrap pt-3">
									<div class="heart-icon">
										<i class="bi bi-heart"></i>
									</div>
									<div class="repeat-icon">
										<i class="bi bi-repeat"></i>
									</div>
								</div>
								<div class="modalFooterInfo">
									<!-- 좋아요 숫자랑 작성일 적는 칸 -->
								</div>

								<!-- 댓글작성폼 -->
								<div class="mt-8 border p-4">
									<form method="post">
										<div class="row">

											<div class="col-12">
												<div class="form-group mb-3">

													<textarea class="form-control" id="contact-message"
														name="message" style="height: 50px" placeholder="댓글작성해주세요"></textarea>
												</div>
											</div>
											<div class="col-12">
												<button class="btn btn-primary" type="submit" name="send">게시</button>
											</div>
										</div>
									</form>
								</div>
								<!-- 모달푸터끝 -->
							</div>

						</div>
						<!-- End Product Details -->
					</div>

				</div>

			</div>
		</section>
		<!-- 모달 끝 -->

		<!-- js -->
		<!-- 		포트폴리오리스트띄우는 -->
		<script th:inline="javascript">
		/*<![CDATA[*/
			const portfolio = /*[[${portfolioList}]]*/
			/*]]>*/
			console.log('dkssudgktpdy')
			console.log(portfolio);
			var loginUserId = 'user2';
			
			
		$("div#rowg-3").children().remove();//먼저 깔끔희~
		StandLine(portfolio);//첫페이지 포트폴리오 리스트
		recentStand(portfolio);//최신순
		likeStand(portfolio);//조아용

		//사진 클릭하해서 포트폴리오 번호 가져오기 ~>모달
		$("div .col-sm-6.col-lg-3").click(function() {	
			var portNum = $(this).children('div .portInfo').text(); 
		
		// 해당 번호 가진 배열 찾기
			var selectedPortfolio = portfolio.find(function(findPortfolio) {
				return findPortfolio.portNum === portNum;
			});
		//모달 들어갈자리에 기본 구성 만들어 화면에 붙여주기
		//<모달들어갈자리1>
		//	<오른쪽2>
		//		<사진들어갈자리4></4>
		//	</2>
		//	<왼쪽3>
		//		<5내용헤더></5>
		//		<6내용중앙></6>
		//		<7내용푸터></7>==>푸터는 하트하고 다 구성해두기.
		//	</3>
		//</1>
		//모달 들어갈자리에 기본 구성 만들어 화면에 붙여주기
		
		//화면 구성한 모달에 경우에 따른 하트 출력
		$.ajax({
			url: `/silhyun/isLiked/${loginUserId}/${portNum}`,
		}).then(heart => {
			//(처음화면)값이 있으면 찬하트
			if (heart) {//값이 있으면 //첨에는 찬 하트 출력
				if ($(".heart-icon").children().hasClass("bi-heart")) {
					$(".heart-icon").children().removeClass("bi-heart").addClass("bi-heart-fill");
				}
			} else {//(값이 없으면) //첨에는 빈 하트 출력
				if ($(".heart-icon").children().hasClass("bi-heart-fill")) {
					$(".heart-icon").children().removeClass("bi-heart-fill").addClass("bi-heart");
				}
			}//else끝나는 구간
		});//조아요 대잇나 확인 완.
		////////////////////////////기본모달 구성 완료
		
		
		
		//해당 포트폴리오번호에 맞는 사진 리스트 가져와서 넣어주기 (((1)))시작
			$.ajax({
				url: `/silhyun/detailPortfolioPhoto/${portNum}`,
				dataType: 'json',
			})
				.then(dataModalPhoto => {
					$(".slidePhoto").empty();//이미있는 내용 지우기
			
					for (let i = 0; i < dataModalPhoto.length; i++) {
						//사진 다 만들고 뒤에 슬라이드버튼 만들기
						var modalPhoto = `<div class="swiper-slide">
											<div class="bg-no-repeat bg-cover bg-center"
												style="background-image: url(${dataModalPhoto[i].phoRt});">
												<div class="container">
													<div
														class="row min-vh-85 align-items-center justify-content-center py-12">

													</div>
												</div>
											</div>
										</div>`
						$(".slidePhoto").append(modalPhoto);//만든사진 붙이기
					}
					
					//슬라이드버튼 추가
					var modalSlideButton =`	<div class="swiper-arrow-style-01 swiper-next swiper-next-01">
						<i class="bi-chevron-right"></i>
					</div>
					<div class="swiper-arrow-style-01 swiper-prev swiper-prev-01">
						<i class="bi-chevron-left"></i>
					</div>
					<div class="swiper-pagination swiper-pagination-white"></div>`
					
					$(".slidePhoto").append(modalSlideButton);
				});//해당 포트폴리오번호에 맞는 사진 리스트(((1)))끝 미완
				
				
				
				//해당 포트폴리오 번호에 맞는 헤더 붙여주기(((2)))시작
					var modalheader=`<div class="d-flex review-box border-top mt-4 pt-4">
									<div>
										<div class="review-image">
											<img class="img-fluid" src="${selectedPortfolio.profile}"
												title="" alt="프로필사진자리~~~~">
										</div>
									</div>
									<div class="col ps-3">
										<span><strong class="ptgName">${selectedPortfolio.ptgId}</strong></span>&nbsp;&nbsp; 
										<span><button>follow</button></span>&nbsp;&nbsp;
									</div>
								</div>`											
								$(".modalHeader").empty();
								$(".modalHeader").append(modalheader); //헤더는 다 붙여줌 화면구성을 하자.
				//해당 포트폴리오 번호에 맞는 헤더 붙여주기(((2)))끝
				
				
				
				//해당 포트폴리오 번호에 맞는 내용 븥여주기(((3)))시작
				
				//해당 포트폴리오 쓴 내용 붙이는 거.
				var modalContentSit = `<div>
												<div class="review-image">
													<img class="img-fluid" src="${selectedPortfolio.phoRt}"
														title="" alt="작가프로필사진">
												</div>
											</div>
											<div class="col ps-3">
												<span><strong class="ptgName">${selectedPortfolio.ptgId}</strong></span>&nbsp;&nbsp;
											</div>
											<div>
												<p>${selectedPortfolio.cntn}</p>
												<div>
													<i class="bi bi-heart-fill"></i>&nbsp;
													<span><small class="likeCount">${selectedPortfolio.likes}</small></span>
												</div>
											</div>`

				$(".modalContentSit").empty();
				$(".modalContentSit").append(modalContentSit);
				
				//작가가쓴포트폴리오 작성했을 때 내용 붙이는 거.
				
				
				//해당 포트폴리오 번호에 맞는 내용 븥여주기(((3)))끝
				
				//해당 포트폴리오 번호에 맞는 푸터 븥여주기(((4)))시작
				var modalFooterInfo=`<p>
									좋아요 <span>${selectedPortfolio.likes}</span>
								</p>
							<div>${selectedPortfolio.portDate}</div>작성`
				$(".modalFooterInfo").empty();
				$(".modalFooterInfo").append(modalFooterInfo);
			
				//해당 포트폴리오 번호에 맞는 푸터 븥여주기(((4)))끝
				
				
				
				
				
				//모달안에서 기능 ==1==하트 시작
				
				//모달 하트눌렀을 때 생기는 이벤트
				$(".heart-icon").click(function() {
					//안찬하트라면 눌럿을 때 insert 넣고 성공하면 찬 하트로 바꾸기. 아니면은 실패 메시지.
					var thisHeart = $(this).children();

					if (thisHeart.hasClass("bi-heart")) {
						//값 넣는 아작스
						$.ajax({
							type: 'POST',
							url: '/silhyun/addLike',
							data: JSON.stringify({ id: LoginUserId, portNum: portNum }),
							contentType: 'application/json',
							success: function(result) {
								thisHeart.removeClass("bi-heart").addClass("bi-heart-fill");//찬하트로바꾸기

								//하트 숫자 바꾸기.
								/*		var likeCountElement = thisHeart.closest('.product-detail').find('.likeCount');
										likeCount = parseInt(likeCountElement.text());
										likeCountElement.text(likeCount + 1);*/
							},
							error: function(xhr, status, error) {
								console.log(error);
								alert('좋아요 실패~');
							}
						});
					} else {
						//값 지우는 아작스
						$.ajax({
							url: '/silhyun/deleteLike',
							type: 'POST',
							data: JSON.stringify({ id: LoginUserId, portNum: portNum }),
							contentType: 'application/json',
							headers: {
								'X-HTTP-Method-Override': 'DELETE'
							},
							success: function(response) {
								thisHeart.removeClass("bi-heart-fill").addClass("bi-heart");//빈하트로 바꾸기
							},
							error: function(error) {
								console.log(error);
								alert('조아요 삭제 실패~');
							}
						});
					}//else부분
				});//모달 하트눌렀을 때 생기는 이벤트
				
				//모달안에서 기능 ==1==하트 끝

		
		});//사진 클릭했을 때 생기는 이벤트 끝 
		
		
		
		
		
		
		
		
		
		
		//태그 5개만 가져오긔~~~~~~
		$.ajax({
            url: "/silhyun/tagList",
             type: "get",
             dataType: 'json',
         })
         .then(data => {
   			for(i=0; i<5 && i<data.length; i++){
         	var taag=`<a class="btn btn-sm" href="#" align="center"> <i
				class="">${data[i].tagCntn}</i>
				</a> `
        	$('div .layout-change').append(taag);
   			}
         });
		
		//만든 태그 버튼에 그룹이벤트 주기.
		$('div .layout-change').on('click','a',function(){//layout-change의 a태그에만 click펑션을 주기.//그룹이벤트
			$('div .layout-change .active').removeClass('active');//active클래스만 없애기.
			$(this).addClass('active')
			var tagCntn=$(this).children().text();		
			//해당태그포트폴리오가져오기
			$.ajax({
                      url: "/silhyun/aroundTagList",
                      data:{tagCntn: tagCntn}
                   })
           .then(res => {
        	   console.log(res);
                   	//이전에 리스트 먼저 지워주기
                    $("div#rowg-3").children().remove();	
                   	StandLine(res);
            		recentStand(res);
            		likeStand(res); 		                 
            })
		})
	

	//포트폴리오 사진 리스트 불러오기~함수+포트폴리오 번호
		function StandLine(aa){
			for(i=0; i<aa.length; i++){
				
				const portPhotoList = `<div class="col-sm-6 col-lg-3 btn-modal">
					<div class='portInfo' style='display:none'>${aa[i].portNum}</div>
								<div class="product-card-1">
									<div class="product-card-image">
										<div class="badge-ribbon"></div>
										<div class="product-action">
										
										</div>
										<div class="product-media image-container">
											<a href="#"> <img class="img-fluid"
												src="${aa[i].phoRt}" title="" alt="">
												<div class="overlay">
													<div class="overlayText"><i class="bi bi-heart-fill">&nbsp;</i>${aa[i].likes}</div>
												</div>
											</a>
										</div>
									</div>
								</div>
							</div>`
		
			$("div#rowg-3").append(portPhotoList);		
							
							
							
							//클릭한 사진의 포트폴리오 번호 빼와....?
									
							
			}
		}
		//포트폴리오 사진 리스트 불러오기~함수
		
		
		//최신순 정렬
		function recentStand(portfolioA){
		$("li:contains('최신순')").click(function(){
			const recentList = portfolioA.sort((a, b) => new Date(a.portDate) - new Date(b.portDate));
		$("div#rowg-3").children().remove();	
			StandLine(recentList);
		});
		}
		
		//조아요순 정렬
		function likeStand(portfolioB){
		$("li:contains('좋아요순')").click(function(){
			const likeList = portfolioB.sort((a, b) => b.likes - a.likes)
		$("div#rowg-3").children().remove();	
			StandLine(likeList);
		});
		}
		
	
		
		// 사용자가 입력한 텍스트에서 해시태그(#)를 찾아서 해시태그에 a링크 걸기.
		const text = $('#text').html();
		const regex = /#(\S+)/g;
		const replaced = text.replace(regex, `<a href="/hashtag/$1">#$1</a>`);

		// 대체된 텍스트로 교체합니다.
		$('#text').html(replaced);
		
	
		////////////////////모달~~~
		const modal = $(".modal");
		
		function modalOn() {
		    modal.css("display", "flex");
		}
		
		function isModalOn() {
		    return modal.css("display") === "flex";
		}
		
		function modalOff() {
		    modal.css("display", "none");
		}
		
		$('.btn-modal').on('click', function() {
		    modalOn();
		});
		
		$('.close-area').on('click', function() {
		    modalOff();
		});
		
		modal.on("click", function(e) {
		    const evTarget = e.target;
		    if ($(evTarget).hasClass("modal-overlay")) {
		        modalOff();
		    }
		});
		
		$(window).on("keyup", function(e) {
		    if (isModalOn() && e.key === "Escape") {
		        modalOff();
		    }
		});
				
		////////////////////모달~~~

		</script>


		<script src="/js/around.js"></script>
		<!-- js -->


		<!-- 
    ========================
       End Wrapper 
    ========================
    -->
		<!-- script start -->
		<!-- jquery -->
		<script src="/js/jquery-3.5.1.min.js"></script>
		<!--bootstrap-->
		<script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
		<!-- slick carousel -->
		<script src="/vendor/swiper/swiper-bundle.min.js"></script>
		<!-- magnific -->
		<script src="/vendor/magnific/jquery.magnific-popup.min.js"></script>
		<!-- isotope -->
		<script src="/vendor/isotope/isotope.pkgd.min.js"></script>
		<!-- count-down -->
		<script src="/vendor/count-down/jquery.countdown.min.js"></script>
		<!-- count-down -->
		<script src="/vendor/jarallax/jarallax-all.js"></script>
		<!-- Theme Js -->
		<script src="/js/custom.js"></script>
		<script src="/js/theme.js"></script>

		<!-- End script start -->
	</div>
</body>

</html>