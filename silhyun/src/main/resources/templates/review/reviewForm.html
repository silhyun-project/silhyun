<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
</head>
  <link href="/css/star.css" rel="stylesheet"/>
<style>
  textarea {
    width: 100%;
    height: 25em;
    border: none;
    resize: none;
  }
  #grey {
  	background-color: #EBE9E6;
  	text-align: center;
  }
  #myform{
  	border: 1px;
  }
  #btn{
  	text-align: center;
  }
  
  #attZone{
	width: 100%;
	min-height:150px;
	padding:10px;
	border:1px solid #D2D6D6;
	}
	#attZone:empty:before{
		content : attr(data-placeholder);
		color : #999;
		font-size:.9em;
	}
</style>
<body>
<div class="container col-5">
	<form class="mb-3" id="myform" action="insert" method="post" enctype="multipart/form-data"> 
		<div id="grey">
				<span class="text-bold">별점을 선택해주세요</span><br>
			<fieldset>
				<input type="radio" name="star" value="5" id="rate1"><label
					for="rate1">★</label>
				<input type="radio" name="star" value="4" id="rate2"><label
					for="rate2">★</label>
				<input type="radio" name="star" value="3" id="rate3"><label
					for="rate3">★</label>
				<input type="radio" name="star" value="2" id="rate4"><label
					for="rate4">★</label>
				<input type="radio" name="star" value="1" id="rate5"><label
					for="rate5">★</label>
			</fieldset>
		</div>	
		
		<table class="table table-border">
			<tr>
				<td>
					<textarea class="form-control" name="cntn" placeholder="내용을 입력해주세요" maxlength="2200"></textarea>
				</td>
			</tr>
			<tr>
				<td>
					<div id='preview'>
						<input type='file' id='btnAtt' name='files' multiple='multiple'/>
						<div id='attZone' 
						      data-placeholder='사진은 jpg, jpeg, png형식으로 5개까지 등록가능합니다.'></div>
					</div>
				</td>
			</tr>
		</table>
		
		<input type="hidden" name="id" value="${}"> <!-- 섹션이나 시큐리티 아이디값 -->
      	<input type="hidden" name="ctgrNum" value="${}">  <!-- 이전 페이지 작가아이디 -->
      	<div id="btn">
	      	<button type="submit" class="btn btn-outline-secondary btn-sm">작성</button>
	      	<button type="button" class="btn btn-outline-secondary btn-sm">뒤로가기</button> 
      	</div>
	</form>
	<script>
	(
		imageView = function imageView(att, btn){
			var attZone = document.getElementById(att);
			var btnAtt = document.getElementById(btn);
			//첨부파일 목록 저장변수
			var selFiles = [];
			
			//이미지 밖 div css
			var divStyle = 'display:inline-block;position:relative;'
	              + 'width:150px;height:120px;margin:5px;border:1px solid #00f;z-index:1';
			// 미리보기 이미지 css
			var imgStyle = 'width:100%;height:100%;z-index:none';
			// 이미지안에 표시되는 체크박스의 css
			var chkStyle = 'width:30px;height:30px;position:absolute;font-size:24px;'
			              + 'right:0px;bottom:0px;z-index:999;background-color:rgba(255,255,255,0.1);color:#f00';
			
			//파일을 선택했을때
			btnAtt.onchange = function(e){
				var files = e.target.files;
				var fileArr = Array.prototype.sliece.call(files)  //여러파일들을 배열로 바꿔줌
				for(f of fileArr){
					imageLoader(f); //file태그로 부터 파일들을 각각 전달받아서 화면 표시
				}
			}
			
			//파일 드롭했을때
			//탐색기에서 드래그앤 드롭 사용시 브라우저에 뜨는거 막기
		    attZone.addEventListener('dragenter', function(e){
		      e.preventDefault();
		      e.stopPropagation();
		    }, false)
		    
		    attZone.addEventListener('dragover', function(e){
		      e.preventDefault();
		      e.stopPropagation();
		      
		    }, false)
		    
		    attZone.addEventListener('drop', function(e){
		      var files = {};
		      e.preventDefault();
		      e.stopPropagation();
		      var dt = e.dataTransfer;  //드래그 할때 가져온 데이터 객체
		      files = dt.files;
		      for(f of files){
		        imageLoader(f);
		      }
		      
		    }, false)
		    
		    //첨부된 이미지들 배열에 넣고 미리보기
		    imageLoader = function(file){
		    	selFiles.push(file)
		    	var reader = new FileReader();
		    	reader.onload = function(ee){
		    		let img = document.createElement('img')
		    		img.setAttribute('style', imgStyle)
		    		img.src = ee.target.result
		    		attZone.appendChild(makeDiv(img, file))
		    	}
		    	reader.readAsDataURL(file)
			}
			
			//선택된 파일 삭제
			//첨부파일이 있는 경우 checkbox와 함께 attZone에 추가할 div 만들기
			makeDiv = function

		}
		)('attZone', 'btnAtt')
	</script>
</div>
</body>
</html>