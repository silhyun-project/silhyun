<!doctype html>
<html lang="zxx" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{home/layout}">
<style>

#popup{
  background-color:white;
  border :1px solid black;
  width : 300px;
  height : 400px;
  position :fixed;
  top:0;
  left:0;
}
#btn1{
  float:right;
  display: inline;
  width: 100px;
  height:30px;
}

</style>


<head>
<!-- metas -->
<meta charset="utf-8">
<meta name="author" content="pxdraft" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="keywords" content="ShopApp - eCommerce Bootstrap 5 Template" />
<meta name="description"
	content="ShopApp - eCommerce Bootstrap 5 Template" />
<!-- title -->
<title>댓글 대댓글</title>
<!-- Favicon -->
<link rel="shortcut icon" href="/img/favicon.ico">
<!-- CSS Template -->
<link href="/css/theme.css" rel="stylesheet">
</head>

<body>
<div layout:fragment="content">
	<div class="pt-4 mt-5" id="comRepBox"> 
		<!-- 댓글 -->
	    <ul class="list-unstyled pt-4"> 
	        <li class="media d-flex">
	            <div class="avatar rounded-circle">
	                <img class="img-fluid" src="/img/pages/1000x1000.jpg" title="" alt="">
	            </div>
	            <div class="col ps-3">
	                <h6 class="mt-0 mb-1" id="comId"></h6>
	                <label class="mb-2 small" id="comDate"></label>
	                <p></p>
	                <div class="nav dark-link small">
						<a class="ms-3" href="#contact-message"> 댓글 달기 </a> 
						 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
						<button id="replyShowBtn" style="border:none; background-color: white;">
						답글 보기</button>
					<input type="hidden" id="grp" name="grp">
	                </div>
	                
	                <!-- 대댓글 -->
	                <div id="replyBox"> 
	                 <ul class="list-unstyled mt-5 pt-5 border-top">
	                    <li class="media d-flex">
	                        <div class="avatar rounded-circle">
	                            <img class="img-fluid" src="/img/pages/1000x1000.jpg" title="" alt="">
	                        </div>
	                        <div class="col ps-3">
	                            <h6 class="mt-0 mb-1"></h6>
	                            <label class="mb-2 small"></label>
	                            <p></p>
	                            <div class="nav dark-link small">
	                                <a class="ms-3" href="#">
	                                    답글 달기
	                                </a>
	                            </div>
	                        </div>
	                    </li>
	                </ul>
	                </div>
	            </div>
	        </li>
	    </ul>
	</div>
	<div class="mt-8 border p-4">
		<form method="post">
			<div class="row">

				<div class="col-12">
					<div class="form-group mb-3">
						<label class="form-label rd-input-label" for="contact-message">당신의 댓글 : </label>							
						<textarea class="form-control" id="contact-message" name="message"
							style="height: 50px" placeholder="댓글 작성해주세요"></textarea>
					</div>
				</div>
				<div class="col-12">
					<button class="btn btn-primary" type="submit" id="send">게시</button>
				</div>
			</div>
		</form>
	</div>

	<!-- blog end -->

	<!-- End Main -->
	<!-- Footer -->

	<!-- End Footer -->
	<!-- 
    ========================
       End Wrapper 
    ========================
    -->
	<!-- script start -->
	<!-- jquery -->
	<script src="/js/jquery-3.5.1.min.js"></script>
	<!--bootstrap-->
	<script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
	<!-- slick carousel -->
	<script src="/vendor/swiper/swiper-bundle.min.js"></script>
	<!-- magnific -->
	<script src="/vendor/magnific/jquery.magnific-popup.min.js"></script>
	<!-- isotope -->
	<script src="/vendor/isotope/isotope.pkgd.min.js"></script>
	<!-- count-down -->
	<script src="/vendor/count-down/jquery.countdown.min.js"></script>
	<!-- count-down -->
	<script src="/vendor/jarallax/jarallax-all.js"></script>
	<!-- Theme Js -->
	<script src="/js/custom.js"></script>
	<script src="/js/theme.js"></script>
	<!-- End script start -->
	
	<script>
	$(document).ready(function(){
		getCommentList()
	})
		
	
	$("#send").click(function(){
			let comId =$("#comId").val(); //댓글작성자
			let ctgr = 'C'; //카테고리
			let ctgrNum = '12'; //카테고리번호
			let contactMessage =$("#contact-message").val(); //댓글내용
			let dep = 0; //댓글깊이(댓글,대댓글)
			let grp = $("#grp").val(); //댓글그룹
			
			
			if(contactMessage == ""){
				alert("내용을 입력해 주세요.")
				$("#contact-message").focus();
				return false;		// 내용 미입력시 작성 불가
			}
		
		$.ajax({
			url:"/commentInsert",
			type:"POST",
			data: JSON.stringify(
				{
					"comNum" : comNum, 
					"comId" :comId,
					"ctgr" : ctgr, 
					"ctgrNum" : ctgrNum,
					"contact-message" : contactMessage,
					"dep" : dep,					
					"grp": grp
				}
			),
			contentType:'application/json',
			success : function(data){
				console.log("댓글등록")
				$("#contactMessage").val("")
				console.log("====")
				getCommentList()
			},
			error:function(){
				alert('등록실패');
			}
		});
	});
	
	
		function getCommentList(){
			
			let commentArea = $("#comRepBox")
			$.ajax({
				url:"/commentList",
				success : function(result){
					let str = ''
					$(result).each(function(index,comm){
							str += '<ul class="list-unstyled pt-4">'
							str += '<li class="media d-flex">'
							str += '<div class="avatar rounded-circle">'
							str += '<img class="img-fluid" src="/img/pages/1000x1000.jpg" title="" alt="">'
							str += '</div>'
							str += '<h6 class="mt-0 mb-1 commentId" >'+comm.comId+'</h6>'
							str += '<label class="mb-2 small" >'+comm.comDate+'</label>'
							str += '<p>'+comm.cntn+'</p>'
							str += '<div class="nav dark-link small">'
							str += '<a class="ms-3" href="#contact-message"> 답글 달기 </a>'
							str += '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'
							str += '<button class="replyShowBtn" style="border:none; background-color: white;">답글 보기</button>'								
							str += '<input type="hidden" class="grp" name="grp" value="'+comm.grp+'">'
							str += '</div>'
					})
					commentArea.html(str);
				}
			})
		}
			
			

		

		
		
		
	</script>
</div>
</body>
</html>