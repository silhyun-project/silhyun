<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="co.yedam.silhyun.portfolio.map.PortfolioMapper">


	<select id="findLike"
		parameterType="co.yedam.silhyun.portfolio.vo.LikePhotoVO"
		resultType="int">
		SELECT COUNT(*)
		FROM LIKE_PHOTO
		WHERE ID = #{id} AND PORT_NUM = #{portNum}
	</select>

	<insert id="insertLike"
		parameterType="co.yedam.silhyun.portfolio.vo.LikePhotoVO">
		INSERT INTO LIKE_PHOTO (ID, PORT_NUM)
		VALUES (#{id},
		#{portNum})
	</insert>

	<delete id="deleteLike"
		parameterType="co.yedam.silhyun.portfolio.vo.LikePhotoVO">
		DELETE FROM LIKE_PHOTO WHERE ID = #{id} AND PORT_NUM = #{portNum}
	</delete>

	<select id="detailPortfolio"
		resultType="co.yedam.silhyun.portfolio.vo.PortfolioVO"
		parameterType="String">
		SELECT A.PHO_RT, A.PHO_NUM,
		P.*, NVL(L.LIKESS, 0) LIKES
		FROM (SELECT PHO_RT, PHO_NUM, CTGR_NUM
		FROM PHOTO
		WHERE PHO_NUM IN (SELECT MIN(TO_NUMBER(PHO_NUM))
		FROM PHOTO
		WHERE CTGR ='P'
		GROUP BY CTGR_NUM)
		ORDER BY PHO_NUM) A
		INNER JOIN PORTFOLIO P
		ON A.CTGR_NUM = P.PORT_NUM
		LEFT OUTER JOIN (SELECT PORT_NUM, COUNT(*) LIKESS
		FROM LIKE_PHOTO
		GROUP BY PORT_NUM) L
		ON P.PORT_NUM = L.PORT_NUM
		WHERE P.PORT_NUM = #{portNum}
	</select>

	<select id="detailPortfolioPhoto"
		resultType="co.yedam.silhyun.portfolio.vo.PortfolioVO"
		parameterType="String">
		SELECT PH.PHO_NUM,PH.PHO_RT,PO.PORT_NUM,PO.PTG_ID
		FROM PHOTO PH, PORTFOLIO PO
		WHERE PH.CTGR_NUM = PO.PORT_NUM
		AND PH.CTGR = 'P'
		AND PORT_NUM=#{portNum}
	</select>
	

</mapper>